<!DOCTYPE html><html lang="ru" prefix="og: https://ogp.me/ns#" data-astro-cid-sckkx6r4> <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><link rel="icon" href="/favicon.png"><title>–ù–µ–æ–±—ã—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Fork API ¬∑ –°–µ—Ä–≥–µ–π –°–æ–≤–∞</title><meta property="og:title" content="–ù–µ–æ–±—ã—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Fork API ¬∑ –°–µ—Ä–≥–µ–π –°–æ–≤–∞"><meta name="twitter:title" content="–ù–µ–æ–±—ã—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Fork API ¬∑ –°–µ—Ä–≥–µ–π –°–æ–≤–∞"><meta property="og:site_name" content="–°–µ—Ä–≥–µ–π –°–æ–≤–∞"><meta property="description" content="–ö–∞–∫ –µ—â–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Fork API –µ—Å–ª–∏ –Ω–µ SSR –∏–ª–∏ —Ç–µ—Å—Ç—ã?"><meta property="og:description" content="–ö–∞–∫ –µ—â–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Fork API –µ—Å–ª–∏ –Ω–µ SSR –∏–ª–∏ —Ç–µ—Å—Ç—ã?"><meta property="twitter:description" content="–ö–∞–∫ –µ—â–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Fork API –µ—Å–ª–∏ –Ω–µ SSR –∏–ª–∏ —Ç–µ—Å—Ç—ã?"><meta name="keywords" content="Effector, JavaScript, TypeScript, Software Development, React, Testing, Consulting"><meta content="og:locale" content="ru_RU"><meta property="og:url" content="https://sova.sh/ru/unusual-use-of-fork-api/"><meta property="canonical" content="https://sova.sh/ru/unusual-use-of-fork-api/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@sova_original"><meta name="twitter:site" content="@sova_original"><link rel="me" href="https://techhub.social/@sergeysova"><meta name="theme-color" content="#1F2028"><script type="application/javascript" async src="https://www.googletagmanager.com/gtag/js?id=UA-67236238-5"></script><script type="application/javascript">window.dataLayer = window.dataLayer || [];function gtag() {  dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-67236238-5');</script><link rel="stylesheet" href="/_astro/application-structure.BQPXAHZp.css"><body data-astro-cid-sckkx6r4>  <main class="mx-auto mb-10 w-full max-w-[65ch] px-6 xl:max-w-[80ch]" data-astro-cid-xsct23v3> <img src="/_astro/articles.B8WlmEuG.svg" class="my-10 pr-10" data-astro-cid-xsct23v3> <div class="go-back" data-astro-cid-xsct23v3> <a href="/" data-astro-cid-xsct23v3>
‚Üµ
–í–µ—Ä–Ω—É—Ç—å—Å—è  </a> </div> <h1 class="mt-8 mb-6 text-2xl font-medium sm:text-3xl md:text-4xl xl:text-5xl" data-astro-cid-xsct23v3> –ù–µ–æ–±—ã—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Fork API </h1> <div class="prose markdown max-w-[66ch] xl:max-w-[80ch]" data-astro-cid-xsct23v3> <h1 id="table-of-contents"><a aria-hidden="true" tabindex="-1" href="#table-of-contents"><span class="icon icon-link"></span></a>Table of Contents</h1>
<ul>
<li><a href="#%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5">–í–≤–µ–¥–µ–Ω–∏–µ</a></li>
<li><a href="#%D0%B4%D0%B0-%D0%BA%D1%82%D0%BE-%D1%82%D0%B0%D0%BA%D0%BE%D0%B9-%D1%8D%D1%82%D0%BE%D1%82-%D0%B2%D0%B0%D1%88-fork-api">–î–∞ –∫—Ç–æ —Ç–∞–∫–æ–π —ç—Ç–æ—Ç –≤–∞—à Fork API</a>
<ul>
<li><a href="#%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%B0">–ü—Ä–æ–±–ª–µ–º–∞</a></li>
<li><a href="#%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5">–†–µ—à–µ–Ω–∏–µ</a></li>
</ul>
</li>
<li><a href="#%D0%BA%D0%B0%D0%BA-%D0%B5%D1%89%D0%B5-%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D1%8C">–ö–∞–∫ –µ—â–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</a>
<ul>
<li><a href="#%D0%BA%D0%B0%D0%BA-%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B5%D0%BD%D0%BE">–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ</a></li>
<li><a href="#%D1%81%D0%BA%D0%BE%D1%83%D0%BF%D1%8B-%D0%BA%D0%BE%D0%BC%D0%BD%D0%B0%D1%82">–°–∫–æ—É–ø—ã –∫–æ–º–Ω–∞—Ç</a></li>
<li><a href="#%D0%B2%D0%BA%D1%80%D0%B0%D1%82%D1%86%D0%B5">–í–∫—Ä–∞—Ç—Ü–µ</a></li>
<li><a href="#%D1%87%D1%82%D0%BE-%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D0%BB-%D0%B2-%D0%B8%D1%82%D0%BE%D0%B3%D0%B5">–ß—Ç–æ –ø–æ–ª—É—á–∏–ª –≤ –∏—Ç–æ–≥–µ</a></li>
</ul>
</li>
</ul>
<h1 id="–≤–≤–µ–¥–µ–Ω–∏–µ"><a aria-hidden="true" tabindex="-1" href="#–≤–≤–µ–¥–µ–Ω–∏–µ"><span class="icon icon-link"></span></a>–í–≤–µ–¥–µ–Ω–∏–µ</h1>
<p>–ö–æ–≥–¥–∞ –∑–∞—Ö–æ–¥–∏—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ fork API, –æ–±—ã—á–Ω–æ –≤—Å–ø–æ–º–∏–Ω–∞—é—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏. –í —ç—Ç–æ–π
—Å—Ç–∞—Ç—å–µ —Å–ø–µ—à—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –∏ –ø–æ–∫–∞–∑–∞—Ç—å –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π —Å–ø–µ–∫—Ç—Ä –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–π —ç—Ç–æ–≥–æ API.</p>
<h1 id="–¥–∞-–∫—Ç–æ-—Ç–∞–∫–æ–π-—ç—Ç–æ—Ç-–≤–∞—à-fork-api"><a aria-hidden="true" tabindex="-1" href="#–¥–∞-–∫—Ç–æ-—Ç–∞–∫–æ–π-—ç—Ç–æ—Ç-–≤–∞—à-fork-api"><span class="icon icon-link"></span></a>–î–∞ –∫—Ç–æ —Ç–∞–∫–æ–π —ç—Ç–æ—Ç –≤–∞—à Fork API</h1>
<p class="p-0 text-[3em]">üî®</p>
<h2 id="–ø—Ä–æ–±–ª–µ–º–∞"><a aria-hidden="true" tabindex="-1" href="#–ø—Ä–æ–±–ª–µ–º–∞"><span class="icon icon-link"></span></a>–ü—Ä–æ–±–ª–µ–º–∞</h2>
<p>–û–±—ã—á–Ω–æ <a href="https://effector.dev">effector</a> —Ö—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–≤ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤–Ω—É—Ç—Ä–∏ –æ–±—ä–µ–∫—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ <code>createStore</code>. –•—É–∫–∏
React –∏–ª–∏ SolidJS –≤—ã—Ç–∞—Å–∫–∏–≤–∞—é—Ç
–∑–Ω–∞—á–µ–Ω–∏–µ <a href="https://github.com/effector/effector/blob/88d721a0a0279109e4a45ba79568b5197152b080/src/react/apiBase.ts#L10">–Ω–∞–ø—Ä—è–º—É—é –∏–∑ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞</a>
–ø–æ —Å—Å—ã–ª–∫–µ.</p>
<pre class="language-tsx" data-language="tsx"><code is:raw class="language-tsx"><span class="token keyword">const</span> $name <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token string">&#39;Sergey Sova&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span>$name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Name: </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>–í —Å–ª—É—á–∞–µ —Å SSR, –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Å–µ—Ä–≤–µ—Ä—É –Ω—É–∂–Ω–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–º –∫–ª–∏–µ–Ω—Ç–∞–º –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –ö–∞–∫ –º—ã –ø–æ–º–Ω–∏–º Node.JS/Deno/Bun ‚Äî –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–∞—è —Å—Ä–µ–¥–∞, –Ω–æ –∑–∞ —Å—á–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ —É–¥–∞–µ—Ç—Å—è –¥–æ–±–∏—Ç—å—Å—è —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º–æ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è. –ü–æ–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–µ–Ω—Ç–∞ –ê –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ HTTP-–∑–∞–ø—Ä–æ—Å–∞, —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∫–ª–∏–µ–Ω—Ç–æ–≤ –ë –∏–ª–∏ –í.</p>
<p>–ú—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –ª–æ–≥–∏–∫–∏, –≤–µ–¥—å <a href="https://effector.dev/ru/docs/api/effector/effect">—ç—Ñ—Ñ–µ–∫—Ç—ã</a> –±—É–∫–≤–∞–ª—å–Ω–æ —è–≤–ª—è—é—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏. –î–æ–≤–æ–ª—å–Ω–æ –ª–µ–≥–∫–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–µ–±–µ —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ <em>–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π</em> –¥–æ—Å—Ç—É–ø —Ä–∞–∑–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –æ–±—â–µ–≥–æ —Å—Ç–æ—Ä–∞ –º–æ–∂–µ—Ç –≤—Å–µ —Å–ª–æ–º–∞—Ç—å.</p>
<p>–ü–æ–∫–∞ —É –Ω–∞—Å –æ–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —ç—Ç–∏–º–∏ —Å—Ç–æ—Ä–∞–º–∏, –≤—Å–µ –æ–∫–µ–π.</p>
<pre class="language-ts" data-language="ts"><code is:raw class="language-ts"><span class="token keyword">const</span> reset <span class="token operator">=</span> <span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> run <span class="token operator">=</span> <span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> waitFx <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> $counter <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

$counter<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>reset<span class="token punctuation">)</span><span class="token punctuation">;</span>

$counter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>run<span class="token punctuation">,</span> <span class="token punctuation">(</span>list<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token operator">...</span>list<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">manual </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">sample</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  clock<span class="token operator">:</span> run<span class="token punctuation">,</span>
  target<span class="token operator">:</span> waitFx<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

$counter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>waitFx<span class="token punctuation">.</span>done<span class="token punctuation">,</span> <span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token punctuation">{</span>params<span class="token operator">:</span> name<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
  <span class="token operator">...</span>list<span class="token punctuation">,</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">fx done </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

$counter<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;counter&#39;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// counter []</span>

<span class="token function">run</span><span class="token punctuation">(</span><span class="token string">&#39;A&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// counter [&quot;manual A&quot;]</span>

<span class="token function">run</span><span class="token punctuation">(</span><span class="token string">&#39;B&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// counter [&quot;manual A&quot;, &quot;manual B&quot;]</span>

<span class="token comment">// counter [&quot;manual A&quot;, &quot;manual B&quot;, &quot;fx done A&quot;]</span>
<span class="token comment">// counter [&quot;manual A&quot;, &quot;manual B&quot;, &quot;fx done A&quot;, &quot;fx done B&quot;]</span>
</code></pre>
<p><a href="https://share.effector.dev/5oBljPUk">Playground</a></p>
<p>–î–æ–ø—É—Å—Ç–∏–º <code>run(&#39;A&#39;)</code> –∏ <code>run(&#39;B&#39;)</code> —ç—Ç–æ –≤—ã–∑–æ–≤—ã —Ä–∞–∑–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –ó–¥–µ—Å—å –Ω–∞–≥–ª—è–¥–Ω–æ –≤–∏–¥–Ω–æ, —á—Ç–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –æ–±—â–∏–π –º–∞—Å—Å–∏–≤, –∏ –≤ –∏—Ç–æ–≥–µ –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏—é –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—Ç —Å–º–µ—à–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –ï—Å–ª–∏ –±—ã —ç—Ç–æ –±—ã–ª —Å—Ç–æ—Ä —Å –æ–±—ã—á–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, —Ç–æ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞–ª–∏ –±—ã —á—É–∂–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –í—ã–∑–æ–≤ –∏–≤–µ–Ω—Ç–∞ <code>reset</code> –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ –Ω–∏–∫–∞–∫ –Ω–µ —Å–ø–∞—Å–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—é:</p>
<pre class="language-ts" data-language="ts"><code is:raw class="language-ts"><span class="token function">run</span><span class="token punctuation">(</span><span class="token string">&#39;A&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// counter [&quot;manual A&quot;]</span>

<span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// counter []</span>

<span class="token function">run</span><span class="token punctuation">(</span><span class="token string">&#39;B&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// counter [&quot;manual B&quot;]</span>

<span class="token comment">// counter [&quot;manual B&quot;, &quot;fx done A&quot;]</span>
<span class="token comment">// counter [&quot;manual B&quot;, &quot;fx done A&quot;, &quot;fx done B&quot;]</span>
</code></pre>
<p><a href="https://share.effector.dev/6bzTKXwA">Playground</a></p>
<p>–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –ø–æ—Ç–µ—Ä—è–Ω–æ –æ–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π –º–∞—Å—Å–∏–≤–∞, —Ç–æ–≥–¥–∞ –∫–∞–∫ <code>&quot;fx done A&quot;</code> –≤—Å–µ –µ—â–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω.</p>
<h2 id="—Ä–µ—à–µ–Ω–∏–µ"><a aria-hidden="true" tabindex="-1" href="#—Ä–µ—à–µ–Ω–∏–µ"><span class="icon icon-link"></span></a>–†–µ—à–µ–Ω–∏–µ</h2>
<p>–ê —á—Ç–æ –µ—Å–ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–µ—Å—Ç–µ?</p>
<pre class="language-ts" data-language="ts"><code is:raw class="language-ts"><span class="token comment">// –ü—Å–µ–≤–¥–æ–∫–æ–¥</span>
<span class="token keyword">const</span> clientA <span class="token operator">=</span> <span class="token punctuation">{</span>stores<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> clientB <span class="token operator">=</span> <span class="token punctuation">{</span>stores<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç A –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–≤–æ–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è,</span>
<span class="token comment">// —á–∏—Ç–∞—Ç—å –∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–≤ –≤ –æ–±—ä–µ–∫—Ç clientA</span>

<span class="token function">run</span><span class="token punctuation">(</span><span class="token string">&#39;A&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
clientA<span class="token punctuation">.</span>stores<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>$counter<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;manual A&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>–ü—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç fork API. –° –ø–æ–º–æ—â—å—é –≤—ã–∑–æ–≤–∞ <code>fork()</code> –º—ã —Å–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç ‚Äî scope, –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–≤. –ò–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ, –≤ SSR –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã React –∏–ª–∏ SolidJS –≤ <code>Provider</code>.</p>
<pre class="language-tsx" data-language="tsx"><code is:raw class="language-tsx"><span class="token keyword">const</span> scope <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>scope<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>–ß—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ —Å–∫–æ—É–ø–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <code>allSettled</code> –∏–ª–∏ <a href="https://effector.dev/ru/docs/api/effector-react/useEvent"><code>useEvent</code></a>:</p>
<pre class="language-ts" data-language="ts"><code is:raw class="language-ts"><span class="token keyword">await</span> <span class="token function">allSettled</span><span class="token punctuation">(</span>run<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  scope<span class="token punctuation">,</span>
  params<span class="token operator">:</span> <span class="token string">&#39;A&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><a href="https://share.effector.dev/h9rENxUp">Playground</a></p>
<p>–†–∞–±–æ—Ç–∞–µ—Ç —ç—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ:
—é–Ω–∏—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –≤ <code>allSettled</code> –ø–µ—Ä–≤—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å–µ–±–µ —Å—Å—ã–ª–∫—É –Ω–∞ <code>scope</code>, —Å—Ç–æ—Ä—ã –ø—Ä–æ—á–∏—Ç–∞—é—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –µ—â–µ –Ω–µ –±—ã–ª–æ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç <code>.defaultState</code>, –∏ –∑–∞–ø–∏—à—É—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ –≤ scope. –≠—Ñ—Ñ–µ–∫—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á—É—Ç—å —Å–ª–æ–∂–Ω–µ–µ, –≤–µ–¥—å –≤ –Ω–∏—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ scope –º–µ–∂–¥—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –≤—ã–∑–æ–≤–∞–º–∏, –Ω–æ –∏–¥–µ—è –¥—É–º–∞—é –ø–æ–Ω—è—Ç–Ω–∞.</p>
<h1 id="–∫–∞–∫-–µ—â–µ-–º–æ–∂–Ω–æ-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å"><a aria-hidden="true" tabindex="-1" href="#–∫–∞–∫-–µ—â–µ-–º–æ–∂–Ω–æ-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å"><span class="icon icon-link"></span></a>–ö–∞–∫ –µ—â–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</h1>

<p>–Ø —Ä–µ—à–∏–ª —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–≥—Ä—ã —Å –¥—Ä—É–∑—å—è–º–∏ –≤ <a href="https://munchkin.game/">–Ω–∞—Å—Ç–æ–ª–∫—É</a> ‚Äî Munchkin level counter. –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É <a href="https://web.allmunchkins.com/">–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º—É –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é</a> —Å —ç—Ñ—Ñ–µ–∫—Ç–æ—Ä–æ–º –∏ –≤–µ–±—Å–æ–∫–µ—Ç–∞–º–∏.</p>
<p>–°—É—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞—Ö:</p>
<p>–ò–≥—Ä–∞ ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ –≤–µ–± –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ò–≥—Ä–æ–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—É, –∑–∞—Ö–æ–¥—è—Ç –≤ –æ–±—â—É—é –∫–æ–º–Ω–∞—Ç—É, –≤–∏–¥—è—Ç —Å—á–µ—Ç –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤, –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å —Å–≤–æ–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç —á–µ–π —Å–µ–π—á–∞—Å —Ö–æ–¥ –∏ –ø–æ–ª—É—á–∞—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</p>

<img src="/_astro/1.BhSSy4AT_Z1UOCxT.webp" srcset="/_astro/1.BhSSy4AT_zpxj5.webp 420w, /_astro/1.BhSSy4AT_11NbvJ.webp 680w, /_astro/1.BhSSy4AT_1dUhyy.webp 820w, /_astro/1.BhSSy4AT_Z1UOCxT.webp 1390w" alt="–°–ø–∏—Å–æ–∫ –∫–æ–º–Ω–∞—Ç" width="1390" height="964" loading="lazy" decoding="async">
<p>–í –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –µ—Å—Ç—å —Å–≤–æ—è –ª–æ–≥–∏–∫–∞, –Ω–µ –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–∞—è, –Ω–æ –∏–º–µ–µ—Ç—Å—è: —è –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö–æ–¥–∞, –ø–æ–¥—Å—á–µ—Ç –æ—á–∫–æ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –æ—á–∫–æ–≤ –ø—Ä–∏ —Å–º–µ—Ä—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞, –Ω–µ –ø–æ–∑–≤–æ–ª—è—é –æ–ø—É—Å—Ç–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–∏–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –ú–æ–∂–Ω–æ –±—ã–ª–æ –±—ã —Å—á–∏—Ç–∞—Ç—å –≤—Å–µ —ç—Ç–æ —É –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ, –Ω–æ —è –æ—á–µ–Ω—å –Ω–µ —Ö–æ—Ç–µ–ª –∑–∞–º–æ—Ä–∞—á–∏–≤–∞—Ç—å—Å—è —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –∏–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å <a href="https://crdt.tech/">CRDT</a>. –ü–ª—é—Å, –∏–≥—Ä–æ–∫–∏ –Ω–µ –≤—Å–µ–≥–¥–∞ —Ö–æ—Ç—è—Ç –¥–µ—Ä–∂–∞—Ç—å –≤–∫–ª–∞–¥–∫—É –æ—Ç–∫—Ä—ã—Ç–æ–π –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ, –∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω—É–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –∏–≥—Ä—ã.</p>

<img src="/_astro/2.C6TdHq7R_25Srhs.webp" srcset="/_astro/2.C6TdHq7R_Z2idKjc.webp 420w, /_astro/2.C6TdHq7R_yHTdC.webp 680w, /_astro/2.C6TdHq7R_9rpay.webp 820w, /_astro/2.C6TdHq7R_25Srhs.webp 1390w" alt="–ì–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ" width="1390" height="1186" loading="lazy" decoding="async">
<p>–°—Ä–∞–∑—É –æ–≥–æ–≤–æ—Ä—é—Å—å, —á—Ç–æ —è –Ω–µ –±–æ—Ä—é—Å—å –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è –¥—Ä—É–∑–µ–π. –¢–æ—á–Ω–æ —Ç–∞–∫ –∂–µ —è –Ω–µ –ø–µ—Ä–µ–∂–∏–≤–∞—é –æ –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö, –≤–µ–¥—å –±–æ–ª—å—à–µ 6 –∏–≥—Ä–æ–∫–æ–≤ –≤ –∫–æ–º–Ω–∞—Ç–µ –æ–±—ã—á–Ω–æ –Ω–µ –±—ã–≤–∞–µ—Ç. –í–æ–∑–º–æ–∂–Ω–æ, –≤ –±—É–¥—É—â–µ–º —è –¥–æ–±–∞–≤–ª—é –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏, –Ω–æ —Å–µ–π—á–∞—Å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–∞–∂–µ –Ω–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚Äî –∑–∞—à–µ–ª –∏ –∏–≥—Ä–∞–µ—à—å.</p>
<p>–ö–∞–∫ –∏–º–µ–Ω–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —è —Å–Ω–∞—á–∞–ª–∞ –Ω–µ –∑–Ω–∞–ª, –Ω–æ –º–Ω–µ –ø—Ä–∏—à–ª–∞ –≤ –≥–æ–ª–æ–≤—É —Ç–∞–∫–∞—è —Å—Ö–µ–º–∞: –∏–≥—Ä–æ–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –≤–µ–±—Å–æ–∫–µ—Ç-—Å–æ–±—ã—Ç–∏—è –≤ –∫–æ–º–Ω–∞—Ç—É ‚Äî —è –Ω–∞–∂–∞–ª —Ç–æ-—Ç–æ, –∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –∏–º –ø–æ –≤–µ–±—Å–æ–∫–µ—Ç–∞–º –ø–æ–ª–Ω–æ–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∫–∞–∫ –æ–Ω–æ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è.</p>
<p>–ò –µ—Å–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —ç—Ç—É —Å—Ö–µ–º—É –≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ—Ä–∞, —Ç–æ –≤–∏–¥–Ω–æ –æ—á–µ–Ω—å –ø–æ–Ω—è—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º ‚Äî –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Å–µ—Ä–≤–µ—Ä –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–æ–ª—å –º–æ–¥–µ–ª–∏ ‚Äî —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.</p>
<h2 id="–∫–∞–∫-—É—Å—Ç—Ä–æ–µ–Ω–æ"><a aria-hidden="true" tabindex="-1" href="#–∫–∞–∫-—É—Å—Ç—Ä–æ–µ–Ω–æ"><span class="icon icon-link"></span></a>–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ</h2>
<p>–Ø –≤—ã–¥–µ–ª–∏–ª –≤—Å—é –ª–æ–≥–∏–∫—É –∏–≥—Ä—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª –∏ –Ω–∞–ø–∏—Å–∞–ª –Ω–∞ –Ω–µ—ë —Ç–µ—Å—Ç—ã, –∫–∞–∫ –¥–ª—è –æ–±—ã—á–Ω–æ–π –º–æ–¥–µ–ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</p>
<pre class="language-ts" data-language="ts"><code is:raw class="language-ts"><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;player can grow level&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> scope <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">allSettled</span><span class="token punctuation">(</span>munchkin<span class="token punctuation">.</span>playerJoined<span class="token punctuation">,</span> <span class="token punctuation">{</span>scope<span class="token punctuation">,</span> params<span class="token operator">:</span> John<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">allSettled</span><span class="token punctuation">(</span>munchkin<span class="token punctuation">.</span>playerJoined<span class="token punctuation">,</span> <span class="token punctuation">{</span>scope<span class="token punctuation">,</span> params<span class="token operator">:</span> Alba<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> <span class="token function">allSettled</span><span class="token punctuation">(</span>munchkin<span class="token punctuation">.</span>levelUp<span class="token punctuation">,</span> <span class="token punctuation">{</span>scope<span class="token punctuation">,</span> params<span class="token operator">:</span> John<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>scope<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span>munchkin<span class="token punctuation">.</span>$players<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toStrictEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token operator">...</span>John<span class="token punctuation">,</span> level<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    Alba<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;player can lose level&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> scope <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">allSettled</span><span class="token punctuation">(</span>munchkin<span class="token punctuation">.</span>playerJoined<span class="token punctuation">,</span> <span class="token punctuation">{</span>scope<span class="token punctuation">,</span> params<span class="token operator">:</span> John<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">allSettled</span><span class="token punctuation">(</span>munchkin<span class="token punctuation">.</span>playerJoined<span class="token punctuation">,</span> <span class="token punctuation">{</span>scope<span class="token punctuation">,</span> params<span class="token operator">:</span> Alba<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> <span class="token function">allSettled</span><span class="token punctuation">(</span>munchkin<span class="token punctuation">.</span>levelUp<span class="token punctuation">,</span> <span class="token punctuation">{</span>scope<span class="token punctuation">,</span> params<span class="token operator">:</span> John<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">allSettled</span><span class="token punctuation">(</span>munchkin<span class="token punctuation">.</span>levelDown<span class="token punctuation">,</span> <span class="token punctuation">{</span>scope<span class="token punctuation">,</span> params<span class="token operator">:</span> John<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>scope<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span>munchkin<span class="token punctuation">.</span>$players<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toStrictEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span>John<span class="token punctuation">,</span> Alba<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><a href="https://gist.github.com/sergeysova/14318b49f81c692234f05dd6f786c33c">–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ <code>munchkin.ts</code></a></p>
<p>–ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —ç—Ç–∏ —Å–æ–±—ã—Ç–∏—è –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä? –ú–æ–∂–Ω–æ –±—ã–ª–æ –±—ã —Å–¥–µ–ª–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è—é—â–∏–π type –∏ payload –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –≥–¥–µ –º—ã —á–µ—Ä–µ–∑ switch/case –±—É–¥–µ–º –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∏–≤–µ–Ω—Ç –º–æ–¥–µ–ª–∏ –∏ –≤—ã–∑—ã–≤–∞—Ç—å —Å payload.</p>
<pre class="language-jsx" data-language="jsx"><code is:raw class="language-jsx"><span class="token comment">// client</span>
<span class="token keyword">const</span> stepFinishedFx <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sendWSEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;stepFinished&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> gearIncreaseFx <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sendWSEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;gearIncrease&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> gearDecreaseFx <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sendWSEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;gearDecrease&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> deadFx <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sendWSEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;dead&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> levelUpFx <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sendWSEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;levelUp&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// server</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>type<span class="token punctuation">,</span> value<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token string">&#39;gameEvent&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> gameType<span class="token punctuation">,</span> payload<span class="token punctuation">}</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>gameType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&#39;stepFinished&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> player <span class="token operator">=</span> <span class="token function">getCurrentPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> room <span class="token operator">=</span> player<span class="token punctuation">.</span><span class="token function">getRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">gameFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Bang!</span>
        <span class="token function">sendUpdates</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>–ù–æ –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–∏—à–∫–æ–º –º—É—Ç–æ—Ä–Ω–æ, –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —é–Ω–∏—Ç–æ–≤ –ø—Ä–∏–¥–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–∞.</p>
<p>–ê —á—Ç–æ, –µ—Å–ª–∏ —è –±—É–¥—É –≤—ã–∑—ã–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é —Ç–µ –∂–µ —Å–æ–±—ã—Ç–∏—è –∏–∑ –º–æ–¥–µ–ª–∏ –∏–≥—Ä—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –∑–∞—Å—Ç–∞–≤–ª—é —ç—Ñ—Ñ–µ–∫—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –≥–¥–µ –±—É–¥—É –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Ö –≤ –Ω—É–∂–Ω—É—é –∫–æ–º–Ω–∞—Ç—É –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è?</p>
<p>–î–ª—è —ç—Ç–æ–≥–æ —è –≤—ã–¥–µ–ª–∏–ª –Ω–∞–±–æ—Ä –ø—É–±–ª–∏—á–Ω—ã—Ö –∏–≤–µ–Ω—Ç–æ–≤ –∏–∑ —ç—Ç–æ–π –º–æ–¥–µ–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª, –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª –µ–≥–æ –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥.</p>
<pre class="language-tsx" data-language="tsx"><code is:raw class="language-tsx"><span class="token comment">// common</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> common <span class="token operator">=</span> <span class="token function">createDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> levelUp <span class="token operator">=</span> common<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createEvent</span><span class="token generic class-name"><span class="token operator">&lt;</span>Uuid<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> levelDown <span class="token operator">=</span> common<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createEvent</span><span class="token generic class-name"><span class="token operator">&lt;</span>Uuid<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> playerKill <span class="token operator">=</span> common<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createEvent</span><span class="token generic class-name"><span class="token operator">&lt;</span>Uuid<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> gearIncrease <span class="token operator">=</span> common<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createEvent</span><span class="token generic class-name"><span class="token operator">&lt;</span>Uuid<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> gearDecrease <span class="token operator">=</span> common<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createEvent</span><span class="token generic class-name"><span class="token operator">&lt;</span>Uuid<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> gearReset <span class="token operator">=</span> common<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createEvent</span><span class="token generic class-name"><span class="token operator">&lt;</span>Uuid<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> $gameMode <span class="token operator">=</span> common<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createStore</span><span class="token generic class-name"><span class="token operator">&lt;</span>GameMode<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#39;common&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> $players <span class="token operator">=</span> common<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">createStore</span><span class="token generic class-name"><span class="token operator">&lt;</span>Player<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>–î–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –±–∞–Ω–¥–ª–∞ –±—É–¥—É—Ç –ø—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ sid‚Äô—ã –∫–∞–∂–¥–æ–º—É —Å—Ç–æ—Ä—É. –í–µ–¥—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Ñ–∞–π–ª–∞ –Ω–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–∞. SID ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —é–Ω–∏—Ç–∞, –∑–∞–≤–∏—Å—è—â–∏–π –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –æ—Ç –ø–æ–ª–æ–∂–µ–Ω–∏—è —é–Ω–∏—Ç–∞ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ –ø—Ä–æ–µ–∫—Ç–∞.</p>
<blockquote>
<p>–°–æ–≤–µ—Ç: —á—Ç–æ–±—ã –±—ã–ª–æ –ø—Ä–æ—â–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –∏–º–µ–Ω–∞ –∏–≤–µ–Ω—Ç–æ–≤ –∏ —Å—Ç–æ—Ä–æ–≤ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –ø–æ websocket, –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø—Ü–∏—é <code>debugSids: true</code> –≤ <code>effector/babel-plugin</code>.</p>
</blockquote>
<p>–ó–∞—Ç–µ–º, —Å –ø–æ–º–æ—â—å—é –¥–æ–º–µ–Ω–∞ –ø—Ä–æ—à–µ–ª—Å—è –ø–æ –∫–∞–∂–¥–æ–º—É —Å–æ–±—ã—Ç–∏—é –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª –≤—ã–∑–æ–≤ —Å–æ–±—ã—Ç–∏—è –≤ —ç—Ñ—Ñ–µ–∫—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.</p>
<pre class="language-tsx" data-language="tsx"><code is:raw class="language-tsx"><span class="token comment">// client</span>
munchkin<span class="token punctuation">.</span>common<span class="token punctuation">.</span><span class="token function">onCreateEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">sample</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    clock<span class="token operator">:</span> event<span class="token punctuation">,</span>
    <span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>sid<span class="token operator">:</span> event<span class="token punctuation">.</span>sid<span class="token punctuation">,</span> payload<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    target<span class="token operator">:</span> sendGameEventFx<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—Å–µ –≥–æ—Ä–∞–∑–¥–æ –ø—Ä–æ—â–µ, –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–µ—Ç–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ, —è –Ω–∞—Ö–æ–∂—É –≤ –æ–±—ä–µ–∫—Ç–µ —Å–æ–±—ã—Ç–∏–µ —Å –Ω—É–∂–Ω—ã–º <code>.sid</code> –∏ –≤—ã–∑—ã–≤–∞—é –µ–≥–æ –Ω–∞ —Å–∫–æ—É–ø–µ –∫–æ–º–Ω–∞—Ç—ã —á–µ—Ä–µ–∑ <code>allSettled</code>.</p>
<pre class="language-tsx" data-language="tsx"><code is:raw class="language-tsx"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> munchkin <span class="token keyword">from</span> <span class="token string">&#39;../common/munchkin&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> <span class="token string">&#39;gameEvent&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>sid<span class="token punctuation">,</span> payload<span class="token punctuation">}</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token keyword">const</span> room <span class="token operator">=</span> <span class="token function">getRoomOfPlayer</span><span class="token punctuation">(</span>me<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> unit <span class="token keyword">of</span> munchkin<span class="token punctuation">.</span>common<span class="token punctuation">.</span>history<span class="token punctuation">.</span>events<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>unit<span class="token punctuation">.</span>sid <span class="token operator">===</span> sid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">await</span> <span class="token function">allSettled</span><span class="token punctuation">(</span>unit<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            scope<span class="token operator">:</span> room<span class="token punctuation">.</span>scope<span class="token punctuation">,</span>
            params<span class="token operator">:</span> payload<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="—Å–∫–æ—É–ø—ã-–∫–æ–º–Ω–∞—Ç"><a aria-hidden="true" tabindex="-1" href="#—Å–∫–æ—É–ø—ã-–∫–æ–º–Ω–∞—Ç"><span class="icon icon-link"></span></a>–°–∫–æ—É–ø—ã –∫–æ–º–Ω–∞—Ç</h2>
<p>–ö–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É, —è —Å—Ä–∞–∑—É –∂–µ –≤—ã–ø–æ–ª–Ω—è—é <code>fork()</code> –∏ —Å–æ—Ö—Ä–∞–Ω—è—é —Å—Å—ã–ª–∫—É –≤ –æ–±—ä–µ–∫—Ç–µ –∫–æ–º–Ω–∞—Ç—ã.</p>
<pre class="language-tsx" data-language="tsx"><code is:raw class="language-tsx"><span class="token keyword">function</span> <span class="token function">roomCreate</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Room <span class="token punctuation">{</span>
  <span class="token keyword">const</span> room <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token function">sentenceCase</span><span class="token punctuation">(</span><span class="token function">createRoomName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    teammates<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    scope<span class="token operator">:</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>–ö–æ–Ω–µ—á–Ω–æ –∂–µ, –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –º–Ω–µ –Ω–µ —Ö–æ—Ç–µ–ª–æ—Å—å –±—ã —Ç–µ—Ä—è—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ –∏–≥—Ä—ã, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –º—ã —Å –¥—Ä—É–∑—è–º–∏ –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É –ø–æ–∑–∂–µ.</p>
<p>–ü–æ—ç—Ç–æ–º—É –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–≥—Ä—ã –Ω–∞ –¥–∏—Å–∫, —è –≤—ã–ø–æ–ª–Ω—è—é —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞–∂–¥–æ–≥–æ —Å–∫–æ—É–ø–∞. –ó–∞—Ç–µ–º, –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–∑ –¥–∏—Å–∫–∞, —è –∑–∞–≥—Ä—É–∂–∞—é –≤ —Å–∫–æ—É–ø –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–¥–∞—á—É –≤ values.</p>
<pre class="language-tsx" data-language="tsx"><code is:raw class="language-tsx"><span class="token comment">// backup</span>
<span class="token keyword">const</span> gameState <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span>room<span class="token punctuation">.</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// restore</span>
room<span class="token punctuation">.</span>scope <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">{</span>values<span class="token operator">:</span> backup<span class="token punctuation">.</span>gameState<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p><strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</strong>: —ç—Ç–æ—Ç —Ç—Ä—é–∫ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ –ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å –¥–∏—Å–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ –∏–≥—Ä—ã. –¢–æ–≥–¥–∞ –ø–æ–º–µ–Ω—è—é—Ç—Å—è sid‚Äô—ã —Å—Ç–æ—Ä–æ–≤. –ü–æ —Ö–æ—Ä–æ—à–µ–º—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–º —Å–ø–æ—Å–æ–±–æ–º.</p>
</blockquote>
<p>–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏–ª–µ—Ç–µ–ª–æ, —è –æ—Ç–ø—Ä–∞–≤–ª—è—é –µ–≥–æ –≤ —Å–∫–æ—É–ø –∫–æ–º–Ω–∞—Ç—ã, —Ç–∞–º –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞ –Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ—Ä–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–æ—Ä—ã:</p>
<pre class="language-tsx" data-language="tsx"><code is:raw class="language-tsx"><span class="token comment">// ...</span>
<span class="token keyword">await</span> <span class="token function">allSettled</span><span class="token punctuation">(</span>unit<span class="token punctuation">,</span> <span class="token punctuation">{</span>scope<span class="token operator">:</span> room<span class="token punctuation">.</span>scope<span class="token punctuation">,</span> params<span class="token operator">:</span> payload<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre>
<p>–¢–µ–ø–µ—Ä—å –º–Ω–µ –Ω–∞–¥–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å—Ç–æ—Ä—ã –æ–±—Ä–∞—Ç–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä, –∫–∞–∂–¥–æ–º—É –∏–≥—Ä–æ–∫—É.</p>
<p>–î–ª—è —ç—Ç–æ–≥–æ —è –¥–æ–±–∞–≤–∏–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –æ–±—ä–µ–∫—Ç–∞ –∫–æ–º–Ω–∞—Ç—ã. –¢–∞–∫ –∫–∞–∫ —Ç–∞–º —É–∂–µ –µ—Å—Ç—å –æ–±—ä–µ–∫—Ç —Å–∫–æ—É–ø–∞, —è –º–æ–≥—É –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ—Ä–∞ –≤ –Ω—ë–º.</p>
<p>–î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å –Ω–æ–≤–µ–π—à–µ–µ –∞–ø–∏ <code>createWatch</code> –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–µ –≤ 22.3.0.</p>
<blockquote>
<p><strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</strong>: <code>createWatch</code> —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫—Ä–∞–π–Ω–µ –Ω–µ—Ç—Ä–∏–≤–∏–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω–æ–≥–æ –∫–æ–¥–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä <code>effector-react</code>. –ó–¥–µ—Å—å <code>createWatch</code> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞. –ü–æ —Ö–æ—Ä–æ—à–µ–º—É, —Å–ª–µ–¥—É–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç—Ç—É –ª–æ–≥–∏–∫—É –Ω–∞ —ç—Ñ—Ñ–µ–∫—Ç–∞—Ö.</p>
</blockquote>
<p>–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–æ—Ä–∞ –≤ —Å–∫–æ—É–ø–µ, –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –∫–æ–ª–ª–±–µ–∫. –í —ç—Ç–æ–º –∫–æ–ª–ª–±–µ–∫–µ —è –±—É–¥—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫–æ—É–ø–∞ –∫–∞–∂–¥–æ–º—É –∞–∫—Ç–∏–≤–Ω–æ–º—É –∏–≥—Ä–æ–∫—É.</p>
<pre class="language-tsx" data-language="tsx"><code is:raw class="language-tsx"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> munchkin <span class="token keyword">from</span> <span class="token string">&#39;../common/munchkin&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–¥–∏–Ω —Å—Ç–æ—Ä</span>
<span class="token function">createWatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  unit<span class="token operator">:</span> munchkin<span class="token punctuation">.</span>$players<span class="token punctuation">,</span>
  scope<span class="token operator">:</span> room<span class="token punctuation">.</span>scope<span class="token punctuation">,</span>
  <span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sendUpdates</span><span class="token punctuation">(</span>room<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –≤—Å–µ —Å—Ç–æ—Ä—ã –≤ –æ–±—ä–µ–∫—Ç–µ</span>
Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>munchkin<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>unit<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">is</span><span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span>unit<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">createWatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      unit<span class="token punctuation">,</span>
      scope<span class="token operator">:</span> room<span class="token punctuation">.</span>scope<span class="token punctuation">,</span>
      <span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sendUpdates</span><span class="token punctuation">(</span>room<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// –ø–æ–¥–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω</span>
munchkin<span class="token punctuation">.</span>common<span class="token punctuation">.</span><span class="token function">onCreateStore</span><span class="token punctuation">(</span><span class="token punctuation">(</span>unit<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">createWatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    unit<span class="token punctuation">,</span>
    scope<span class="token operator">:</span> room<span class="token punctuation">.</span>scope<span class="token punctuation">,</span>
    <span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">sendUpdates</span><span class="token punctuation">(</span>room<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>–¢–∞–∫ –∫–∞–∫ –Ω–∞–º –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–Ω–æ–≥–æ —Å—Ç–æ—Ä–æ–≤, —Ç–æ –ø—Ä–æ—â–µ –ø–æ–º–µ—Å—Ç–∏—Ç—å –∏—Ö –≤ –µ–¥–∏–Ω—ã–π –¥–æ–º–µ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ —Ä–∞–∑–æ–º, –∏—Å–ø–æ–ª—å–∑—É—è —Ö—É–∫ <code>onCreateStore</code>. –ê –µ—Å–ª–∏ –±—É–¥—É—Ç —Å—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞, —Ç–æ –æ–Ω–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –Ω–µ –≤ –¥–æ–º–µ–Ω–µ.</p>
<pre class="language-tsx" data-language="tsx"><code is:raw class="language-tsx"><span class="token keyword">function</span> <span class="token function">sendUpdates</span><span class="token punctuation">(</span>room<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> states <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span>room<span class="token punctuation">.</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">forEach</span><span class="token punctuation">(</span>room<span class="token punctuation">.</span>players<span class="token punctuation">,</span> <span class="token punctuation">(</span>player<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> player<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;gameUpdate&#39;</span><span class="token punctuation">,</span> states<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>–í –±—Ä–∞—É–∑–µ—Ä–Ω–æ–º –∫–æ–¥–µ, –≤—Å–µ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ.</p>
<p>–ö–æ–≥–¥–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏–ª–µ—Ç–∞—é—Ç —Å–æ–±—ã—Ç–∏—è, —è –∏—Ö —Ä–∞–∑–±–∏—Ä–∞—é –Ω–∞ —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ø–æ –ø–æ–ª—é <code>type</code>. –î–ª—è —ç—Ç–æ–≥–æ –∫—Ä–∞–π–Ω–µ –ø–æ–ª–µ–∑–µ–Ω –º–µ—Ç–æ–¥ <code>split</code></p>
<pre class="language-tsx" data-language="tsx"><code is:raw class="language-tsx"><span class="token keyword">const</span> messageReceived <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createEvent</span><span class="token generic class-name"><span class="token operator">&lt;</span>Message<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">split</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  source<span class="token operator">:</span> messageReceived<span class="token punctuation">,</span>
  <span class="token function-variable function">match</span><span class="token operator">:</span> <span class="token punctuation">(</span>message<span class="token operator">:</span> Message<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> message<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
  cases<span class="token operator">:</span> <span class="token punctuation">{</span>
    gameUpdated<span class="token punctuation">,</span>
    roomsUpdated<span class="token punctuation">,</span>
    roomLeft<span class="token punctuation">,</span>
    __<span class="token operator">:</span> messageUnknown<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>–°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É <code>gameUpdated</code>, –Ω–æ —Ç–æ–ª—å–∫–æ —Å —Ç–µ–º–∏ —Å—Ç–æ—Ä–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã.
–ú–µ—Ç–æ–¥ <code>spread</code> –∏–∑ –ø–∞—Ç—Ä–æ–Ω—É–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –æ–±—ä–µ–∫—Ç–∞ –≤ —Å—Ç–æ—Ä—ã –ø–æ –∏—Ö <code>.sid</code></p>
<pre class="language-tsx" data-language="tsx"><code is:raw class="language-tsx"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> munchkin <span class="token keyword">from</span> <span class="token string">&#39;../common/munchkin&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// —Ä—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ .sid</span>
<span class="token function">spread</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  source<span class="token operator">:</span> gameUpdated<span class="token punctuation">,</span>
  targets<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>munchkin<span class="token punctuation">.</span>$players<span class="token punctuation">.</span>sid<span class="token punctuation">]</span><span class="token operator">:</span> munchkin<span class="token punctuation">.</span>$players<span class="token punctuation">,</span>
    <span class="token punctuation">[</span>munchkin<span class="token punctuation">.</span>$gameMode<span class="token punctuation">.</span>sid<span class="token punctuation">]</span><span class="token operator">:</span> munchkin<span class="token punctuation">.</span>$gameMode<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –≤–µ—Ç–æ–∫ —á–µ—Ä–µ–∑ —Ü–∏–∫–ª</span>
<span class="token function">spread</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  source<span class="token operator">:</span> gameUpdated<span class="token punctuation">,</span>
  targets<span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>
    Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>munchkin<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>unit<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">is</span><span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span>unit<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>unit<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>unit<span class="token punctuation">.</span>sid<span class="token punctuation">,</span> unit<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// –Ω–∞ –∫–∞–∂–¥—ã–π —Å—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω sample</span>
munchkin<span class="token punctuation">.</span>common<span class="token punctuation">.</span><span class="token function">onCreateStore</span><span class="token punctuation">(</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">sample</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    clock<span class="token operator">:</span> gameUpdated<span class="token punctuation">,</span>
    <span class="token function-variable function">filter</span><span class="token operator">:</span> <span class="token punctuation">(</span>states<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> states<span class="token punctuation">[</span>store<span class="token punctuation">.</span>sid<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">&#39;undefined&#39;</span><span class="token punctuation">,</span>
    target<span class="token operator">:</span> store<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>–ù–æ –∏—Å–ø–æ–ª—å–∑—É—è –¥–æ–º–µ–Ω, –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å –∏ –±–µ–∑ <code>spread</code>. –ï—â–µ –æ–¥–∏–Ω –ø–ª—é—Å —Ö—É–∫–æ–≤.</p>
<h2 id="–≤–∫—Ä–∞—Ç—Ü–µ"><a aria-hidden="true" tabindex="-1" href="#–≤–∫—Ä–∞—Ç—Ü–µ"><span class="icon icon-link"></span></a>–í–∫—Ä–∞—Ç—Ü–µ</h2>
<ol>
<li>–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–ø–∏—Å–æ–∫ –∫–æ–º–Ω–∞—Ç —Å–æ —Å–∫–æ—É–ø–∞–º–∏ –∏ —Å–ø–∏—Å–∫–æ–º –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.</li>
<li>–í –±—Ä–∞—É–∑–µ—Ä–∞—Ö –∏–≥—Ä–æ–∫–æ–≤ –∫–∞–Ω–∞–ª websocket, –ø—É–±–ª–∏—á–Ω–æ–µ API –∏–≤–µ–Ω—Ç–æ–≤ –∏ —Å—Ç–æ—Ä–æ–≤ —Å —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–º–∏ –∂–µ SID, –∫–∞–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.</li>
<li>–ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –±–µ—Ä–µ–º –µ–≥–æ <code>sid</code> –∏ payload, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ websocket –Ω–∞ —Å–µ—Ä–≤–µ—Ä.</li>
<li>–°–µ—Ä–≤–µ—Ä –∑–Ω–∞–µ—Ç –≤ –∫–∞–∫–æ–π –∫–æ–º–Ω–∞—Ç–µ —Å–µ–π—á–∞—Å –∏–≥—Ä–æ–∫, –∏—â–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–π event –ø–æ –µ–≥–æ <code>sid</code> –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ <code>allSettled</code> –Ω–∞ —Å–∫–æ—É–ø–µ –∫–æ–º–Ω–∞—Ç—ã.</li>
<li>–õ–æ–≥–∏–∫–∞ –∫—Ä—É—Ç–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Å–∫–æ—É–ø–∞, –≤ —Å–ª–µ–¥—Å—Ç–≤–∏–∏ —á–µ–≥–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å—Ç–æ—Ä—ã, —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–ª–±–µ–∫ <code>createWatch</code>.</li>
<li>–í–Ω—É—Ç—Ä–∏ –∫–æ–º–Ω–∞—Ç—ã –µ—Å—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ websocket-–∫–∞–Ω–∞–ª—ã –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞, –∞ –∑–Ω–∞—á–∏—Ç –º—ã –º–æ–∂–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∂–¥–æ–º—É –∏–≥—Ä–æ–∫—É —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫–æ—É–ø–∞ —Å –ø–æ–º–æ—â—å—é <code>serialize()</code>.</li>
<li>–ë—Ä–∞—É–∑–µ—Ä—ã –∏–≥—Ä–æ–∫–æ–≤ –ª–æ–≤—è—Ç —Å–æ–±—ã—Ç–∏–µ –ø–æ websocket-–∫–∞–Ω–∞–ª—É, –ø–∞—Ä—Å—è—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, <code>split</code> –≤—ã–∑—ã–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–π –Ω–∞–º –∏–≤–µ–Ω—Ç.</li>
<li>–ú–µ—Ç–æ–¥ <code>spread</code> –æ–±–Ω–æ–≤–∏—Ç —Å—Ç–æ—Ä –ø–æ –∫–ª—é—á—É –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏, –≤–µ–¥—å —ç—Ç–æ <code>sid</code>.</li>
<li>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è –∏–∑-–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–≤.</li>
</ol>
<h2 id="—á—Ç–æ-–ø–æ–ª—É—á–∏–ª-–≤-–∏—Ç–æ–≥–µ"><a aria-hidden="true" tabindex="-1" href="#—á—Ç–æ-–ø–æ–ª—É—á–∏–ª-–≤-–∏—Ç–æ–≥–µ"><span class="icon icon-link"></span></a>–ß—Ç–æ –ø–æ–ª—É—á–∏–ª –≤ –∏—Ç–æ–≥–µ</h2>
<p>–í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç—å —à–∏–Ω—É –æ–±—â–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ –±—Ä–∞—É–∑–µ—Ä–æ–≤. –õ—é–±—ã–µ –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ –¥–æ–º–µ–Ω–µ <code>munchkin</code> –±—É–¥—É—Ç –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—Ç—å—Å—è –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∞ —Å—Ç–æ—Ä—ã –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏.</p>
<p>–¢–∞–∫–∂–µ typescript —Å–º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã –∏ –º–Ω–µ –Ω–µ –ø—Ä–∏–¥–µ—Ç—Å—è –≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä—É –Ω–∞ —Å–ª–æ–≤–æ, –≤–µ–¥—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±—É–∫–≤–∞–ª—å–Ω–æ —Ç–æ—Ç –∂–µ –Ω–∞–±–æ—Ä –∏–≤–µ–Ω—Ç–æ–≤ –∏ —Å—Ç–æ—Ä–æ–≤. –û—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–µ–ø–ª–æ–∏—Ç—å —ç—Ç–æ –≤–º–µ—Å—Ç–µ, —á—Ç–æ–±—ã –≤–µ—Ä—Å–∏—è –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ –∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫–æ–¥–∞ —Å–æ–≤–ø–∞–¥–∞–ª–∞, –Ω–æ —ç—Ç–æ —É–∂–µ –≤–æ–ø—Ä–æ—Å –¥—Ä—É–≥–æ–π —Å—Ç–∞—Ç—å–∏.</p>
<p><a href="https://t.me/sergeysova/675">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</a></p> </div> <div class="go-back mt-10" data-astro-cid-xsct23v3> <a href="/" data-astro-cid-xsct23v3>
‚Üµ
–í–µ—Ä–Ω—É—Ç—å—Å—è  </a> </div> </main>  <footer data-astro-cid-sz7xmlte> <div class="content" data-astro-cid-sz7xmlte> <a href="/" data-astro-cid-sz7xmlte> <h3 data-astro-cid-sz7xmlte>–°–µ—Ä–≥–µ–π –°–æ–≤–∞</h3> </a> <div class="links" data-astro-cid-sz7xmlte> <a href="/history" data-astro-cid-sz7xmlte>–ò—Å—Ç–æ—Ä–∏—è</a> <a href="https://t.me/sergeysova" rel="noopener" target="_blank">Telegram</a> <a href="https://youtube.com/@sova" rel="noopener" target="_blank">YouTube</a> <a href="mailto:contact@sergeysova.com" data-astro-cid-sz7xmlte>E-Mail</a> </div> </div> </footer>    </body> </html>  