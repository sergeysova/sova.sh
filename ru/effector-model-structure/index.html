<!DOCTYPE html><html lang="ru" prefix="og: https://ogp.me/ns#" data-astro-cid-sckkx6r4> <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><link rel="icon" href="/favicon.png"><title>Структура моделей Effector · Сергей Сова</title><meta property="og:title" content="Структура моделей Effector · Сергей Сова"><meta name="twitter:title" content="Структура моделей Effector · Сергей Сова"><meta property="og:site_name" content="Сергей Сова"><meta property="description" content="Почему я называю файлики моделями и описываю логику отдельно от сторов и событий"><meta property="og:description" content="Почему я называю файлики моделями и описываю логику отдельно от сторов и событий"><meta property="twitter:description" content="Почему я называю файлики моделями и описываю логику отдельно от сторов и событий"><meta name="keywords" content="Effector, JavaScript, TypeScript, Software Development, React, Testing, Consulting"><meta content="og:locale" content="ru_RU"><meta property="og:url" content="https://sova.sh/ru/effector-model-structure/"><meta property="canonical" content="https://sova.sh/ru/effector-model-structure/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@sova_original"><meta name="twitter:site" content="@sova_original"><link rel="me" href="https://techhub.social/@sergeysova"><meta name="theme-color" content="#1F2028"><script type="application/javascript" async src="https://www.googletagmanager.com/gtag/js?id=UA-67236238-5"></script><script type="application/javascript">window.dataLayer = window.dataLayer || [];function gtag() {  dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-67236238-5');</script><link rel="stylesheet" href="/_astro/application-structure.BQPXAHZp.css"><body data-astro-cid-sckkx6r4>  <main class="mx-auto mb-10 w-full max-w-[65ch] px-6 xl:max-w-[80ch]" data-astro-cid-xsct23v3> <img src="/_astro/articles.B8WlmEuG.svg" class="my-10 pr-10" data-astro-cid-xsct23v3> <div class="go-back" data-astro-cid-xsct23v3> <a href="/" data-astro-cid-xsct23v3>
↵
Вернуться  </a> </div> <h1 class="mt-8 mb-6 text-2xl font-medium sm:text-3xl md:text-4xl xl:text-5xl" data-astro-cid-xsct23v3> Структура моделей Effector </h1> <div class="prose markdown max-w-[66ch] xl:max-w-[80ch]" data-astro-cid-xsct23v3> <h1 id="table-of-contents"><a aria-hidden="true" tabindex="-1" href="#table-of-contents"><span class="icon icon-link"></span></a>Table of contents</h1>
<ul>
<li><a href="#%D0%B2%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5">Введение</a>
<ul>
<li><a href="#model">Model</a>
<ul>
<li><a href="#user-story"><strong>User Story</strong></a></li>
<li><a href="#entity"><strong>Entity</strong></a></li>
</ul>
</li>
<li><a href="#%D1%81%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%B0">Структура</a>
<ul>
<li><a href="#%D1%82%D0%B8%D0%BF%D1%8B">Типы</a></li>
<li><a href="#%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D1%8F">События</a></li>
<li><a href="#%D1%8D%D1%84%D1%84%D0%B5%D0%BA%D1%82%D1%8B">Эффекты</a></li>
<li><a href="#%D1%81%D1%82%D0%BE%D1%80%D1%8B-%D0%B8-%D0%B2%D1%8B%D1%87%D0%B8%D1%81%D0%BB%D1%8F%D0%B5%D0%BC%D1%8B%D0%B5-%D1%81%D1%82%D0%BE%D1%80%D1%8B">Сторы и вычисляемые сторы</a></li>
<li><a href="#%D0%BB%D0%BE%D0%B3%D0%B8%D0%BA%D0%B0-%D0%B2-%D0%B2%D0%B8%D0%B4%D0%B5-%D1%81%D0%B2%D1%8F%D0%B7%D0%B5%D0%B9">Логика в виде связей</a></li>
<li><a href="#%D0%B4%D0%B5%D1%82%D0%B0%D0%BB%D0%B8-%D1%80%D0%B5%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8">Детали реализации</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="введение"><a aria-hidden="true" tabindex="-1" href="#введение"><span class="icon icon-link"></span></a>Введение</h1>
<p>Во время работы, у меня есть три состояния:</p>
<ul>
<li>Читаю существующий код</li>
<li>Изменяю существующий код</li>
<li>Пишу новый код</li>
</ul>
<p>Во время <strong>чтения и изменения</strong> кода, мне необходимо четко понимать какую <strong>задачу</strong> решает каждый кусок кода в файле, в какой <strong>сценарий</strong> складываются эти кусочки и как работают вместе файлы логики в проекте.</p>
<p><strong>Написание нового</strong> кода, я начинаю с проектирования внешнего <strong>интерфейса</strong> файла, с событий которые необходимых в этом блоке логики.</p>
<p>Какие-то файлы описывают <strong>user story</strong>, другие — <strong>сущности</strong>. Детали подхода для каждого из типов файлов несколько отличаются, но код однозначно должен читаться сверху вниз: определения, логика, детали реализации.</p>
<h2 id="model"><a aria-hidden="true" tabindex="-1" href="#model"><span class="icon icon-link"></span></a>Model</h2>
<p>Вне зависимости от типа, я называю модуль с логикой на эффекторе — <strong>модель</strong>.</p>
<h3 id="user-story"><a aria-hidden="true" tabindex="-1" href="#user-story"><span class="icon icon-link"></span></a><strong>User Story</strong></h3>
<p>Чаще всего один или несколько схожих сценариев, решающих одну задачу пользователя. Такой тип модели использую в страницах и организмах фичи, подробности в предыдущей статье <a href="/ru/application-structure">Структура приложения</a>.</p>
<h3 id="entity"><a aria-hidden="true" tabindex="-1" href="#entity"><span class="icon icon-link"></span></a><strong>Entity</strong></h3>
<p>Данные описывающие одну сущность и события ее модифицирующие. У таких моделей обычно нет сценария использования и они лежат в <code>models/</code> директории фичи.</p>
<h2 id="структура"><a aria-hidden="true" tabindex="-1" href="#структура"><span class="icon icon-link"></span></a>Структура</h2>
<ul>
<li>Определения</li>
<li>Логика</li>
</ul>
<p>Модуль поделен на логические блоки идущие в строгом порядке, блоки разделены между собой пустой строкой.</p>
<p>Порядок блоков в модели:</p>
<ol>
<li>Типы</li>
<li>События</li>
<li>Эффекты</li>
<li>Сторы и вычисляемые сторы</li>
<li>Логика в виде связей</li>
<li>Детали реализации</li>
</ol>
<h3 id="типы"><a aria-hidden="true" tabindex="-1" href="#типы"><span class="icon icon-link"></span></a>Типы</h3>
<ul>
<li>В начале определяю типы используемые в модуле. Именно в начале, чтобы любой разработчик сразу мог определить словарь имен типов.</li>
<li>Так как импорты должны идти самыми первыми в файле, удобно видеть сразу и типы созданные в текущем модуле и заимпорченные.</li>
<li>Размещаю здесь необходимые константы</li>
</ul>
<pre class="language-ts" data-language="ts"><code is:raw="" class="language-ts"><span class="token keyword">type</span> <span class="token class-name">InputEvent</span> <span class="token operator">=</span> SyntheticEvent<span class="token operator">&#x3C;</span>HTMLInputElement<span class="token operator">></span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Form</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  login<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  remember<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">MINIMUM_TIMEOUT</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="события"><a aria-hidden="true" tabindex="-1" href="#события"><span class="icon icon-link"></span></a>События</h3>
<ul>
<li>
<p>В этом блоке описываю приватные и публичные события. Когда усаживаюсь проектировать, начинаю именно с этого блока, проставляя всем событиям тип <code>*</code>. После определения интерфейса модуля указываю конкретные типы.</p>
</li>
<li>
<p>Все события именую в camelCase, в прошедшем времени.</p>
</li>
<li>
<p>Формат именования: <code>[неймспейс] сущность событие</code></p>
</li>
<li>
<p>Событие описывает “что произошло”.</p>
</li>
<li>
<p>Имена событиям пропишет Babel plugin effector.</p>
</li>
</ul>
<pre class="language-ts" data-language="ts"><code is:raw="" class="language-ts"><span class="token keyword">export</span> <span class="token keyword">const</span> pageMounted <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createEvent</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token keyword">void</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> loginChanged <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createEvent</span><span class="token generic class-name"><span class="token operator">&#x3C;</span>InputEvent<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> buttonPressed <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createEvent</span><span class="token generic class-name"><span class="token operator">&#x3C;</span>ButtonEvent<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> buttonTypePressed <span class="token operator">=</span> submitPressed<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=></span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> loginSaveFailed <span class="token operator">=</span> <span class="token generic-function"><span class="token function">createEvent</span><span class="token generic class-name"><span class="token operator">&#x3C;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="эффекты"><a aria-hidden="true" tabindex="-1" href="#эффекты"><span class="icon icon-link"></span></a>Эффекты</h3>
<ul>
<li>Только декларация эффекта, без привязки к handler.</li>
<li>Flow требует указания дженерик-типов, если эффект экспортируется.</li>
<li>Имена эффектов также как и событий пропишет Babel plugin effector.</li>
<li>Эффекты именую глаголом с существительным.</li>
<li>При необходимости под каждым эффектом описываю его fetching.</li>
</ul>
<pre class="language-ts" data-language="ts"><code is:raw="" class="language-ts"><span class="token keyword">export</span> <span class="token keyword">const</span> saveLogin <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> saveLoginFetching <span class="token operator">=</span> <span class="token function">createFetching</span><span class="token punctuation">(</span>saveLogin<span class="token punctuation">,</span> <span class="token string">'loading'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> loadLogin <span class="token operator">=</span> <span class="token function">createEffect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="сторы-и-вычисляемые-сторы"><a aria-hidden="true" tabindex="-1" href="#сторы-и-вычисляемые-сторы"><span class="icon icon-link"></span></a>Сторы и вычисляемые сторы</h3>
<ul>
<li>Сторы именую существительным с префиксом <code>$</code>, чтобы всегда однозначно знать где стор. Это нужно, так как почти везде где типизация пустит событие, подойдет и стор. Необходимо иметь возможность с первого взгляда распознать стор не ожидая подсказки типов в IDE. При вводе <code>$</code> IDE подскажет какие сторы имеются, чтобы быстро заимпортить.</li>
<li>Boolean сторы именую с префиксами <code>is</code>, <code>has</code>, <code>was</code>, …</li>
<li>Начальное значение передаю в аргументы <code>createStore</code>, так не нужно создавать лишнее имя <code>storeNameInitial</code>.</li>
<li>Вычисляемые сторы ниже обычных и отделены пустой строкой.</li>
</ul>
<pre class="language-ts" data-language="ts"><code is:raw="" class="language-ts"><span class="token keyword">const</span> $login <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> $password <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> $isLoginValid <span class="token operator">=</span> $login<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>loginValidator<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> $isPasswordValid <span class="token operator">=</span> $login<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>passwordValidator<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> $isFormValid <span class="token operator">=</span> <span class="token function">eachTrue</span><span class="token punctuation">(</span><span class="token punctuation">[</span>$isLoginValid<span class="token punctuation">,</span> $isPasswordValid<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> $form <span class="token operator">=</span> <span class="token function">combine</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  login<span class="token operator">:</span> $login<span class="token punctuation">,</span>
  password<span class="token operator">:</span> $password<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="логика-в-виде-связей"><a aria-hidden="true" tabindex="-1" href="#логика-в-виде-связей"><span class="icon icon-link"></span></a>Логика в виде связей</h3>
<ul>
<li>Здесь только связи между определениями и импортами</li>
<li>Я группирую и сортирую блоки кода так, чтобы логика модели читалась сверху вниз</li>
</ul>
<pre class="language-ts" data-language="ts"><code is:raw="" class="language-ts">$login<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>loginChanged<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>trimEvent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> login<span class="token punctuation">)</span> <span class="token operator">=></span> login<span class="token punctuation">)</span><span class="token punctuation">;</span>
$login<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>pageMounted<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">sample</span><span class="token punctuation">(</span>$form<span class="token punctuation">,</span> submitPressed<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">)</span><span class="token punctuation">;</span>

loginUser<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>authApi<span class="token punctuation">.</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="детали-реализации"><a aria-hidden="true" tabindex="-1" href="#детали-реализации"><span class="icon icon-link"></span></a>Детали реализации</h3>
<ul>
<li>В этом месте определяются все вспомогательные функции, для этого они должны быть описаны как function declaration</li>
</ul>
<pre class="language-ts" data-language="ts"><code is:raw="" class="language-ts"><span class="token keyword">function</span> <span class="token function">trimEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </div> <div class="go-back mt-10" data-astro-cid-xsct23v3> <a href="/" data-astro-cid-xsct23v3>
↵
Вернуться  </a> </div> </main>  <footer data-astro-cid-sz7xmlte> <div class="content" data-astro-cid-sz7xmlte> <a href="/" data-astro-cid-sz7xmlte> <h3 data-astro-cid-sz7xmlte>Сергей Сова</h3> </a> <div class="links" data-astro-cid-sz7xmlte> <a href="/history" data-astro-cid-sz7xmlte>История</a> <a href="https://t.me/sergeysova" rel="noopener" target="_blank">Telegram</a> <a href="https://youtube.com/@sova" rel="noopener" target="_blank">YouTube</a> <a href="mailto:contact@sergeysova.com" data-astro-cid-sz7xmlte>E-Mail</a> </div> </div> </footer>    </body> </html>  